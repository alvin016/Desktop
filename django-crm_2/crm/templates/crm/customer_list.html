{% extends "base.html" %}
{% block title %}å®¢æˆ¶åˆ—è¡¨{% endblock %}
{% block content %}
<h2 class="mb-4">ğŸ“‹ å®¢æˆ¶åˆ—è¡¨</h2>

<form method="get" class="row g-2 mb-4 align-items-end">
  <div class="col-md-4">
    <label>ğŸ” é—œéµå­—</label>
    <input type="text" name="q" class="form-control" placeholder="å§“åã€é›»è©±ã€Email" value="{{ keyword }}">
  </div>

  <div class="col-md-3">
    <label>ğŸ“ ç¸£å¸‚</label>
    <select name="city" class="form-select">
      <option value="">å…¨éƒ¨</option>
      {% for c in city_list %}
        <option value="{{ c }}" {% if c == city %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label>ğŸŒŸ æ˜Ÿåº§</label>
    <select name="constellation" class="form-select">
      <option value="">å…¨éƒ¨</option>
      {% for code, name in constellation_list %}
        <option value="{{ code }}" {% if code == constellation %}selected{% endif %}>{{ name }}</option>
      {% endfor %}
    </select>
  </div>
<div class="col-md-3">
  <label>ğŸ§´ é«˜ç§‘æŠ€ç”¢å“</label>
  <select name="product" class="form-select">
    <option value="">å…¨éƒ¨</option>
    {% for p in product_list %}
      <option value="{{ p.id }}" {% if p.id|stringformat:"s" == product %}selected{% endif %}>
        {{ p.name }}
      </option>
    {% endfor %}
  </select>
</div>

<div class="col-md-3">
  <label>ğŸ”„ ä½¿ç”¨ç‹€æ…‹</label>
  <select name="product_status" class="form-select">
    <option value="">å…¨éƒ¨</option>
    {% for status in product_status_choices %}
  <option value="{{ status.id }}" {% if status.id|stringformat:"s" == product_status %}selected{% endif %}>
    {{ status.name }}
  </option>
{% endfor %}
  </select>
</div>

  <div class="col-md-2 d-grid gap-2">
    <button type="submit" class="btn btn-primary">ç¯©é¸</button>
    <a href="{% url 'customer_list' %}" class="btn btn-outline-secondary">é‡è¨­</a>
  </div>
</form>
{% if customers.has_other_pages %}
<nav aria-label="å®¢æˆ¶åˆ†é " class="mt-4">
  <ul class="pagination justify-content-center">
    {% if customers.has_previous %}
      <li class="page-item">
        <a class="page-link"
   href="?q={{ keyword }}&city={{ city }}&constellation={{ constellation }}&page={{ num }}">
  {{ num }}
</a>
        
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">ä¸Šä¸€é </span></li>
    {% endif %}

    {% for num in customers.paginator.page_range %}
      {% if customers.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
      {% elif num >= customers.number|add:"-2" and num <= customers.number|add:"2" %}
        <li class="page-item">
          <a class="page-link" href="?q={{ keyword }}&page={{ num }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if customers.has_next %}
      <li class="page-item">
        <a class="page-link" href="?q={{ keyword }}&page={{ customers.next_page_number }}">ä¸‹ä¸€é </a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">ä¸‹ä¸€é </span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}


<a href="{% url 'customer_create' %}" class="btn btn-primary mb-3">â• æ–°å¢å®¢æˆ¶</a>

<div class="table-responsive">
  <table class="table table-hover table-bordered bg-white">
    <thead class="table-dark">
      <tr>
        <th>å§“å</th><th>é›»è©±</th>
        <th>ç”Ÿæ—¥</th><th>æ˜Ÿåº§</th><th>æ€§åˆ¥</th><th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for c in customers %}
      <tr>
        
        <td><a href="{% url 'customer_detail' c.id %}">{{ c.name }}</a></td>

        <td>{{ c.phone }}</td>
        <td>{{ c.birthday_md }}</td>
        <td>{{ c.get_constellation_display }}</td>
        <td>
          {% if c.gender == 'M' %}ç”·{% elif c.gender == 'F' %}å¥³{% else %}å…¶ä»–{% endif %}
        </td>
        <td>
          {% if perms.crm.change_customer %}
          <a href="{% url 'customer_edit' c.id %}" class="btn btn-sm btn-warning">âœï¸</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
